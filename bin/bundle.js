!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).module=e()}}((function(){var define,module,exports,createModuleFactory=function(e){var t;return function(n){return t||e(t={exports:{},parent:n},t.exports),t.exports}},_$nearleyLanguageBootstrapped_4=createModuleFactory((function(e,t){!function(){function t(e){return e[0]}function n(e){return e[0].value}var r=Object.assign({ws:{match:/\s+/,lineBreaks:!0,next:"main"},comment:/\#.*/,arrow:{match:/[=-]+\>/,next:"main"},js:{match:/\{\%(?:[^%]|\%[^}])*\%\}/,value:e=>e.slice(2,-2)},word:{match:/[\w\?\+]+/,next:"afterWord"},string:{match:/"(?:[^\\"\n]|\\["\\/bfnrt]|\\u[a-fA-F0-9]{4})*"/,value:e=>JSON.parse(e),next:"main"},btstring:{match:/`[^`]*`/,value:e=>e.slice(1,-1),next:"main"}},function(e){var t={};for(var n of[",","|","$","%","(",")",":?",":*",":+","@include","@builtin","@","]"])t[n]={match:n,next:"main"};return t}()),s=_$moo_1.states({main:Object.assign({},r,{charclass:{match:/\.|\[(?:\\.|[^\\\n])+?\]/,value:e=>new RegExp(e)}}),afterWord:Object.assign({},r,{"[":{match:"[",next:"main"}})}),a={Lexer:s,ParserRules:[{name:"final$ebnf$1",symbols:[s.has("ws")?{type:"ws"}:ws],postprocess:t},{name:"final$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"final",symbols:["_","prog","_","final$ebnf$1"],postprocess:function(e){return e[1]}},{name:"prog",symbols:["prod"],postprocess:function(e){return[e[0]]}},{name:"prog",symbols:["prod","ws","prog"],postprocess:function(e){return[e[0]].concat(e[2])}},{name:"prod",symbols:["word","_",s.has("arrow")?{type:"arrow"}:arrow,"_","expression+"],postprocess:function(e){return{name:e[0],rules:e[4]}}},{name:"prod",symbols:["word",{literal:"["},"wordlist",{literal:"]"},"_",s.has("arrow")?{type:"arrow"}:arrow,"_","expression+"],postprocess:function(e){return{macro:e[0],args:e[2],exprs:e[7]}}},{name:"prod",symbols:[{literal:"@"},"_","js"],postprocess:function(e){return{body:e[2]}}},{name:"prod",symbols:[{literal:"@"},"word","ws","word"],postprocess:function(e){return{config:e[1],value:e[3]}}},{name:"prod",symbols:[{literal:"@include"},"_","string"],postprocess:function(e){return{include:e[2].literal,builtin:!1}}},{name:"prod",symbols:[{literal:"@builtin"},"_","string"],postprocess:function(e){return{include:e[2].literal,builtin:!0}}},{name:"expression+",symbols:["completeexpression"]},{name:"expression+",symbols:["expression+","_",{literal:"|"},"_","completeexpression"],postprocess:function(e){return e[0].concat([e[4]])}},{name:"expressionlist",symbols:["completeexpression"]},{name:"expressionlist",symbols:["expressionlist","_",{literal:","},"_","completeexpression"],postprocess:function(e){return e[0].concat([e[4]])}},{name:"wordlist",symbols:["word"]},{name:"wordlist",symbols:["wordlist","_",{literal:","},"_","word"],postprocess:function(e){return e[0].concat([e[4]])}},{name:"completeexpression",symbols:["expr"],postprocess:function(e){return{tokens:e[0]}}},{name:"completeexpression",symbols:["expr","_","js"],postprocess:function(e){return{tokens:e[0],postprocess:e[2]}}},{name:"expr_member",symbols:["word"],postprocess:t},{name:"expr_member",symbols:[{literal:"$"},"word"],postprocess:function(e){return{mixin:e[1]}}},{name:"expr_member",symbols:["word",{literal:"["},"expressionlist",{literal:"]"}],postprocess:function(e){return{macrocall:e[0],args:e[2]}}},{name:"expr_member$ebnf$1",symbols:[{literal:"i"}],postprocess:t},{name:"expr_member$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"expr_member",symbols:["string","expr_member$ebnf$1"],postprocess:function(e){return e[1]?function(e){for(var t=e.literal,n=[],r=0;r<t.length;r++){var s=t.charAt(r);s.toUpperCase()!==s||s.toLowerCase()!==s?n.push(new RegExp("["+s.toLowerCase()+s.toUpperCase()+"]")):n.push({literal:s})}return{subexpression:[{tokens:n,postprocess:function(e){return e.join("")}}]}}(e[0]):e[0]}},{name:"expr_member",symbols:[{literal:"%"},"word"],postprocess:function(e){return{token:e[1]}}},{name:"expr_member",symbols:["charclass"],postprocess:t},{name:"expr_member",symbols:[{literal:"("},"_","expression+","_",{literal:")"}],postprocess:function(e){return{subexpression:e[2]}}},{name:"expr_member",symbols:["expr_member","_","ebnf_modifier"],postprocess:function(e){return{ebnf:e[0],modifier:e[2]}}},{name:"ebnf_modifier",symbols:[{literal:":+"}],postprocess:n},{name:"ebnf_modifier",symbols:[{literal:":*"}],postprocess:n},{name:"ebnf_modifier",symbols:[{literal:":?"}],postprocess:n},{name:"expr",symbols:["expr_member"]},{name:"expr",symbols:["expr","ws","expr_member"],postprocess:function(e){return e[0].concat([e[2]])}},{name:"word",symbols:[s.has("word")?{type:"word"}:word],postprocess:n},{name:"string",symbols:[s.has("string")?{type:"string"}:string],postprocess:e=>({literal:e[0].value})},{name:"string",symbols:[s.has("btstring")?{type:"btstring"}:btstring],postprocess:e=>({literal:e[0].value})},{name:"charclass",symbols:[s.has("charclass")?{type:"charclass"}:charclass],postprocess:n},{name:"js",symbols:[s.has("js")?{type:"js"}:js],postprocess:n},{name:"_$ebnf$1",symbols:["ws"],postprocess:t},{name:"_$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_",symbols:["_$ebnf$1"]},{name:"ws",symbols:[s.has("ws")?{type:"ws"}:ws]},{name:"ws$ebnf$1",symbols:[s.has("ws")?{type:"ws"}:ws],postprocess:t},{name:"ws$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"ws",symbols:["ws$ebnf$1",s.has("comment")?{type:"comment"}:comment,"_"]}],ParserStart:"final"};void 0!==e&&void 0!==e.exports?e.exports=a:window.grammar=a}()})),_$_empty_11=createModuleFactory((function(e,t){})),_$pathBrowserify_12=createModuleFactory((function(e,t){(function(e){function n(e,t){for(var n=0,r=e.length-1;r>=0;r--){var s=e[r];"."===s?e.splice(r,1):".."===s?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}t.resolve=function(){for(var t="",s=!1,a=arguments.length-1;a>=-1&&!s;a--){var o=a>=0?arguments[a]:e.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(t=o+"/"+t,s="/"===o.charAt(0))}return(s?"/":"")+(t=n(r(t.split("/"),(function(e){return!!e})),!s).join("/"))||"."},t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,s=!0,a=e.length-1;a>=1;--a)if(47===(t=e.charCodeAt(a))){if(!s){r=a;break}}else s=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)};"ab".substr(-1)}).call(this,_$browser_13)})),_$nearley_5={exports:{}},root,factory;root=this,factory=function(){function e(t,n,r){return this.id=++e.highestId,this.name=t,this.symbols=n,this.postprocess=r,this}function t(e,t,n,r){this.rule=e,this.dot=t,this.reference=n,this.data=[],this.wantedBy=r,this.isComplete=this.dot===e.symbols.length}function n(e,t){this.grammar=e,this.index=t,this.states=[],this.wants={},this.scannable=[],this.completed={}}function r(e,t){this.rules=e,this.start=t||this.rules[0].name;var n=this.byName={};this.rules.forEach((function(e){n.hasOwnProperty(e.name)||(n[e.name]=[]),n[e.name].push(e)}))}function s(){this.reset("")}function a(e,t,a){if(e instanceof r){var o=e;a=t}else o=r.fromCompiled(e,t);for(var i in this.grammar=o,this.options={keepHistory:!1,lexer:o.lexer||new s},a||{})this.options[i]=a[i];this.lexer=this.options.lexer,this.lexerState=void 0;var u=new n(o,0);this.table=[u],u.wants[o.start]=[],u.predict(o.start),u.process(),this.current=0}function o(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return e.toString();if(e.type)return"%"+e.type;if(e.test)return"<"+String(e.test)+">";throw new Error("Unknown symbol type: "+e)}}return e.highestId=0,e.prototype.toString=function(e){var t=void 0===e?this.symbols.map(o).join(" "):this.symbols.slice(0,e).map(o).join(" ")+" \u25cf "+this.symbols.slice(e).map(o).join(" ");return this.name+" \u2192 "+t},t.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},t.prototype.nextState=function(e){var n=new t(this.rule,this.dot+1,this.reference,this.wantedBy);return n.left=this,n.right=e,n.isComplete&&(n.data=n.build(),n.right=void 0),n},t.prototype.build=function(){var e=[],t=this;do{e.push(t.right.data),t=t.left}while(t.left);return e.reverse(),e},t.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,a.fail))},n.prototype.process=function(e){for(var t=this.states,n=this.wants,r=this.completed,s=0;s<t.length;s++){var o=t[s];if(o.isComplete){if(o.finish(),o.data!==a.fail){for(var i=o.wantedBy,u=i.length;u--;){var p=i[u];this.complete(p,o)}if(o.reference===this.index){var l=o.rule.name;(this.completed[l]=this.completed[l]||[]).push(o)}}}else{if("string"!=typeof(l=o.rule.symbols[o.dot])){this.scannable.push(o);continue}if(n[l]){if(n[l].push(o),r.hasOwnProperty(l)){var c=r[l];for(u=0;u<c.length;u++){var f=c[u];this.complete(o,f)}}}else n[l]=[o],this.predict(l)}}},n.prototype.predict=function(e){for(var n=this.grammar.byName[e]||[],r=0;r<n.length;r++){var s=n[r],a=this.wants[e],o=new t(s,0,this.index,a);this.states.push(o)}},n.prototype.complete=function(e,t){var n=e.nextState(t);this.states.push(n)},r.fromCompiled=function(t,n){var s=t.Lexer;t.ParserStart&&(n=t.ParserStart,t=t.ParserRules);var a=new r(t=t.map((function(t){return new e(t.name,t.symbols,t.postprocess)})),n);return a.lexer=s,a},s.prototype.reset=function(e,t){this.buffer=e,this.index=0,this.line=t?t.line:1,this.lastLineBreak=t?-t.col:0},s.prototype.next=function(){if(this.index<this.buffer.length){var e=this.buffer[this.index++];return"\n"===e&&(this.line+=1,this.lastLineBreak=this.index),{value:e}}},s.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},s.prototype.formatError=function(e,t){var n=this.buffer;if("string"==typeof n){var r=n.split("\n").slice(Math.max(0,this.line-5),this.line),s=n.indexOf("\n",this.index);-1===s&&(s=n.length);var a=this.index-this.lastLineBreak,o=String(this.line).length;return t+=" at line "+this.line+" col "+a+":\n\n",(t+=r.map((function(e,t){return i(this.line-r.length+t+1,o)+" "+e}),this).join("\n"))+"\n"+i("",o+a)+"^\n"}return t+" at index "+(this.index-1);function i(e,t){var n=String(e);return Array(t-n.length+1).join(" ")+n}},a.fail={},a.prototype.feed=function(e){var t,r=this.lexer;for(r.reset(e,this.lexerState);;){try{if(!(t=r.next()))break}catch(_){var a=new n(this.grammar,this.current+1);throw this.table.push(a),(u=new Error(this.reportLexerError(_))).offset=this.current,u.token=_.token,u}var o=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var i=this.current+1;a=new n(this.grammar,i),this.table.push(a);for(var u,p=void 0!==t.text?t.text:t.value,l=r.constructor===s?t.value:t,c=o.scannable,f=c.length;f--;){var h=c[f],d=h.rule.symbols[h.dot];if(d.test?d.test(l):d.type?d.type===t.type:d.literal===p){var m=h.nextState({data:l,token:t,isToken:!0,reference:i-1});a.states.push(m)}}if(a.process(),0===a.states.length)throw(u=new Error(this.reportError(t))).offset=this.current,u.token=t,u;this.options.keepHistory&&(o.lexerState=r.save()),this.current++}return o&&(this.lexerState=r.save()),this.results=this.finish(),this},a.prototype.reportLexerError=function(e){var t,n,r=e.token;return r?(t="input "+JSON.stringify(r.text[0])+" (lexer error)",n=this.lexer.formatError(r,"Syntax error")):(t="input (lexer error)",n=e.message),this.reportErrorCommon(n,t)},a.prototype.reportError=function(e){var t=(e.type?e.type+" token: ":"")+JSON.stringify(void 0!==e.value?e.value:e),n=this.lexer.formatError(e,"Syntax error");return this.reportErrorCommon(n,t)},a.prototype.reportErrorCommon=function(e,t){var n=[];n.push(e);var r=this.table.length-2,s=this.table[r],a=s.states.filter((function(e){var t=e.rule.symbols[e.dot];return t&&"string"!=typeof t}));return 0===a.length?(n.push("Unexpected "+t+". I did not expect any more input. Here is the state of my parse table:\n"),this.displayStateStack(s.states,n)):(n.push("Unexpected "+t+". Instead, I was expecting to see one of the following:\n"),a.map((function(e){return this.buildFirstStateStack(e,[])||[e]}),this).forEach((function(e){var t=e[0],r=t.rule.symbols[t.dot],s=this.getSymbolDisplay(r);n.push("A "+s+" based on:"),this.displayStateStack(e,n)}),this)),n.push(""),n.join("\n")},a.prototype.displayStateStack=function(e,t){for(var n,r=0,s=0;s<e.length;s++){var a=e[s],o=a.rule.toString(a.dot);o===n?r++:(r>0&&t.push("    ^ "+r+" more lines identical to this"),r=0,t.push("    "+o)),n=o}},a.prototype.getSymbolDisplay=function(e){return function(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return"character matching "+e;if(e.type)return e.type+" token";if(e.test)return"token matching "+String(e.test);throw new Error("Unknown symbol type: "+e)}}(e)},a.prototype.buildFirstStateStack=function(e,t){if(-1!==t.indexOf(e))return null;if(0===e.wantedBy.length)return[e];var n=e.wantedBy[0],r=[e].concat(t),s=this.buildFirstStateStack(n,r);return null===s?null:[e].concat(s)},a.prototype.save=function(){var e=this.table[this.current];return e.lexerState=this.lexerState,e},a.prototype.restore=function(e){var t=e.index;this.current=t,this.table[t]=e,this.table.splice(t+1),this.lexerState=e.lexerState,this.results=this.finish()},a.prototype.rewind=function(e){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[e])},a.prototype.finish=function(){var e=[],t=this.grammar.start;return this.table[this.table.length-1].states.forEach((function(n){n.rule.name===t&&n.dot===n.rule.symbols.length&&0===n.reference&&n.data!==a.fail&&e.push(n)})),e.map((function(e){return e.data}))},{Parser:a,Grammar:r,Rule:e}},_$nearley_5.exports?_$nearley_5.exports=factory():root.nearley=factory(),_$nearley_5=_$nearley_5.exports;var _$browser_13={},cachedSetTimeout,cachedClearTimeout,process=_$browser_13={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,function(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(e){return[]},process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};var _$moo_1={exports:{}},__root_1,__factory_1;__root_1=this,__factory_1=function(){"use strict";var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,n="boolean"==typeof(new RegExp).sticky;function r(e){return e&&"[object RegExp]"===t.call(e)}function s(e){return e&&"object"==typeof e&&!r(e)&&!Array.isArray(e)}function a(e){return e.length?"(?:"+e.map((function(e){return"(?:"+e+")"})).join("|")+")":"(?!)"}function o(e){if("string"==typeof e)return"(?:"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+")";if(r(e)){if(e.ignoreCase)throw new Error("RegExp /i flag not allowed");if(e.global)throw new Error("RegExp /g flag is implied");if(e.sticky)throw new Error("RegExp /y flag is implied");if(e.multiline)throw new Error("RegExp /m flag is implied");return e.source}throw new Error("Not a pattern: "+e)}function i(t,n){if(s(n)||(n={match:n}),n.include)throw new Error("Matching rules cannot also include states");var a={defaultType:t,lineBreaks:!!n.error||!!n.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var o in n)e.call(n,o)&&(a[o]=n[o]);if("string"==typeof a.type&&t!==a.type)throw new Error("Type transform cannot be a string (type '"+a.type+"' for token '"+t+"')");var i=a.match;return a.match=Array.isArray(i)?i:i?[i]:[],a.match.sort((function(e,t){return r(e)&&r(t)?0:r(t)?-1:r(e)?1:t.length-e.length})),a}function u(e){return Array.isArray(e)?function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(r.include)for(var s=[].concat(r.include),a=0;a<s.length;a++)t.push({include:s[a]});else{if(!r.type)throw new Error("Rule has no type: "+JSON.stringify(r));t.push(i(r.type,r))}}return t}(e):function(e){for(var t=Object.getOwnPropertyNames(e),n=[],r=0;r<t.length;r++){var a=t[r],o=e[a],u=[].concat(o);if("include"!==a){var p=[];u.forEach((function(e){s(e)?(p.length&&n.push(i(a,p)),n.push(i(a,e)),p=[]):p.push(e)})),p.length&&n.push(i(a,p))}else for(var l=0;l<u.length;l++)n.push({include:u[l]})}return n}(e)}var p=i("error",{lineBreaks:!0,shouldThrow:!0});function l(e,t){for(var s=null,i=Object.create(null),u=!0,l=null,c=[],f=[],h=0;h<e.length;h++)e[h].fallback&&(u=!1);for(h=0;h<e.length;h++){var d=e[h];if(d.include)throw new Error("Inheritance is not allowed in stateless lexers");if(d.error||d.fallback){if(s)throw!d.fallback==!s.fallback?new Error("Multiple "+(d.fallback?"fallback":"error")+" rules not allowed (for token '"+d.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+d.defaultType+"')");s=d}var m=d.match.slice();if(u)for(;m.length&&"string"==typeof m[0]&&1===m[0].length;)i[m.shift().charCodeAt(0)]=d;if(d.pop||d.push||d.next){if(!t)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+d.defaultType+"')");if(d.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+d.defaultType+"')")}if(0!==m.length){u=!1,c.push(d);for(var _=0;_<m.length;_++){var y=m[_];if(r(y))if(null===l)l=y.unicode;else if(l!==y.unicode&&!1===d.fallback)throw new Error("If one rule is /u then all must be")}var g=a(m.map(o)),P=new RegExp(g);if(P.test(""))throw new Error("RegExp matches empty string: "+P);if(new RegExp("|"+g).exec("").length-1>0)throw new Error("RegExp has capture groups: "+P+"\nUse (?: \u2026 ) instead");if(!d.lineBreaks&&P.test("\n"))throw new Error("Rule should declare lineBreaks: "+P);f.push("("+g+")")}}var b=s&&s.fallback,R=n&&!b?"ym":"gm",w=n||b?"":"|";return!0===l&&(R+="u"),{regexp:new RegExp(a(f)+w,R),groups:c,fast:i,error:s||p}}function c(e,t,n){var r=e&&(e.push||e.next);if(r&&!n[r])throw new Error("Missing state '"+r+"' (in token '"+e.defaultType+"' of state '"+t+"')");if(e&&e.pop&&1!=+e.pop)throw new Error("pop must be 1 (in token '"+e.defaultType+"' of state '"+t+"')")}var f=function(e,t){this.startState=t,this.states=e,this.buffer="",this.stack=[],this.reset()};f.prototype.reset=function(e,t){return this.buffer=e||"",this.index=0,this.line=t?t.line:1,this.col=t?t.col:1,this.queuedToken=t?t.queuedToken:null,this.queuedThrow=t?t.queuedThrow:null,this.setState(t?t.state:this.startState),this.stack=t&&t.stack?t.stack.slice():[],this},f.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedThrow:this.queuedThrow}},f.prototype.setState=function(e){if(e&&this.state!==e){this.state=e;var t=this.states[e];this.groups=t.groups,this.error=t.error,this.re=t.regexp,this.fast=t.fast}},f.prototype.popState=function(){this.setState(this.stack.pop())},f.prototype.pushState=function(e){this.stack.push(this.state),this.setState(e)};var h=n?function(e,t){return e.exec(t)}:function(e,t){var n=e.exec(t);return 0===n[0].length?null:n};function d(){return this.value}if(f.prototype._getGroup=function(e){for(var t=this.groups.length,n=0;n<t;n++)if(void 0!==e[n+1])return this.groups[n];throw new Error("Cannot find token type for matched text")},f.prototype.next=function(){var e=this.index;if(this.queuedGroup){var t=this._token(this.queuedGroup,this.queuedText,e);return this.queuedGroup=null,this.queuedText="",t}var n=this.buffer;if(e!==n.length){if(o=this.fast[n.charCodeAt(e)])return this._token(o,n.charAt(e),e);var r=this.re;r.lastIndex=e;var s=h(r,n),a=this.error;if(null==s)return this._token(a,n.slice(e,n.length),e);var o=this._getGroup(s),i=s[0];return a.fallback&&s.index!==e?(this.queuedGroup=o,this.queuedText=i,this._token(a,n.slice(e,s.index),e)):this._token(o,i,e)}},f.prototype._token=function(e,t,n){var r=0;if(e.lineBreaks){var s=/\n/g,a=1;if("\n"===t)r=1;else for(;s.exec(t);)r++,a=s.lastIndex}var o={type:"function"==typeof e.type&&e.type(t)||e.defaultType,value:"function"==typeof e.value?e.value(t):t,text:t,toString:d,offset:n,lineBreaks:r,line:this.line,col:this.col},i=t.length;if(this.index+=i,this.line+=r,0!==r?this.col=i-a+1:this.col+=i,e.shouldThrow)throw new Error(this.formatError(o,"invalid syntax"));return e.pop?this.popState():e.push?this.pushState(e.push):e.next&&this.setState(e.next),o},"undefined"!=typeof Symbol&&Symbol.iterator){var m=function(e){this.lexer=e};m.prototype.next=function(){var e=this.lexer.next();return{value:e,done:!e}},m.prototype[Symbol.iterator]=function(){return this},f.prototype[Symbol.iterator]=function(){return new m(this)}}return f.prototype.formatError=function(e,t){if(null==e){var n=this.buffer.slice(this.index);e={text:n,offset:this.index,lineBreaks:-1===n.indexOf("\n")?0:1,line:this.line,col:this.col}}var r=Math.max(0,e.offset-e.col+1),s=e.lineBreaks?e.text.indexOf("\n"):e.text.length,a=this.buffer.substring(r,e.offset+s);return t+=" at line "+e.line+" col "+e.col+":\n\n",(t+="  "+a+"\n")+"  "+Array(e.col).join(" ")+"^"},f.prototype.clone=function(){return new f(this.states,this.state)},f.prototype.has=function(e){return!0},{compile:function(e){var t=l(u(e));return new f({start:t},"start")},states:function(e,t){var n=e.$all?u(e.$all):[];delete e.$all;var r=Object.getOwnPropertyNames(e);t||(t=r[0]);for(var s=Object.create(null),a=0;a<r.length;a++)s[P=r[a]]=u(e[P]).concat(n);for(a=0;a<r.length;a++)for(var o=s[P=r[a]],i=Object.create(null),p=0;p<o.length;p++){var h=o[p];if(h.include){var d=[p,1];if(h.include!==P&&!i[h.include]){i[h.include]=!0;var m=s[h.include];if(!m)throw new Error("Cannot include nonexistent state '"+h.include+"' (in state '"+P+"')");for(var _=0;_<m.length;_++){var y=m[_];-1===o.indexOf(y)&&d.push(y)}}o.splice.apply(o,d),p--}}var g=Object.create(null);for(a=0;a<r.length;a++){var P;g[P=r[a]]=l(s[P],!0)}for(a=0;a<r.length;a++){var b=r[a],R=g[b],w=R.groups;for(p=0;p<w.length;p++)c(w[p],b,g);var x=Object.getOwnPropertyNames(R.fast);for(p=0;p<x.length;p++)c(R.fast[x[p]],b,g)}return new f(g,t)},error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:function(e){for(var t=Object.create(null),n=Object.create(null),r=Object.getOwnPropertyNames(e),s=0;s<r.length;s++){var a=r[s],o=e[a];(Array.isArray(o)?o:[o]).forEach((function(e){if((n[e.length]=n[e.length]||[]).push(e),"string"!=typeof e)throw new Error("keyword must be string (in keyword '"+a+"')");t[e]=a}))}function i(e){return JSON.stringify(e)}var u="";for(var p in u+="switch (value.length) {\n",n){var l=n[p];u+="case "+p+":\n",u+="switch (value) {\n",l.forEach((function(e){var n=t[e];u+="case "+i(e)+": return "+i(n)+"\n"})),u+="}\n"}return u+="}\n",Function("value",u)}}},"function"==typeof define&&define.amd?define([],__factory_1):_$moo_1.exports?_$moo_1.exports=__factory_1():__root_1.moo=__factory_1(),_$moo_1=_$moo_1.exports;var _$compile_2={exports:{}};(function(e,t){var n;n=function(n){return function r(s,a){var o,i=(o={},function(e){return e+"$"+(o[e]=(o[e]||0)+1)});a.alreadycompiled||(a.alreadycompiled=[]);for(var u={rules:[],body:[],customTokens:[],config:{},macros:{},start:"",version:a.version||"unknown"},p=0;p<s.length;p++){var l=s[p];if(l.body)a.nojs||u.body.push(l.body);else if(l.include){var c;if(c=l.builtin?_$pathBrowserify_12({}).resolve(t,"../builtin/",l.include):_$pathBrowserify_12({}).resolve(a.args[0]?_$pathBrowserify_12({}).dirname(a.args[0]):e.cwd(),l.include),-1===a.alreadycompiled.indexOf(c)){a.alreadycompiled.push(c);var f=_$_empty_11({}).readFileSync(c).toString(),h=n.Grammar.fromCompiled(_$nearleyLanguageBootstrapped_4({})),d=new n.Parser(h);d.feed(f);var m=r(d.results[0],{args:[c],__proto__:a});u.rules=u.rules.concat(m.rules),u.body=u.body.concat(m.body),u.customTokens=u.customTokens.concat(m.customTokens),Object.keys(m.config).forEach((function(e){u.config[e]=m.config[e]})),Object.keys(m.macros).forEach((function(e){u.macros[e]=m.macros[e]}))}}else l.macro?u.macros[l.macro]={args:l.args,exprs:l.exprs}:l.config?u.config[l.config]=l.value:(_(l.name,l.rules,{}),u.start||(u.start=l.name))}return u;function _(e,t,n){for(var r=0;r<t.length;r++){var s=y(e,t[r],n);a.nojs&&(s.postprocess=null),u.rules.push(s)}}function y(e,t,r){for(var s=[],a=0;a<t.tokens.length;a++){var o=g(e,t.tokens[a],r);null!==o&&s.push(o)}return new n.Rule(e,s,t.postprocess)}function g(e,t,n){if("string"==typeof t)return"null"===t?null:t;if(t instanceof RegExp)return t;if(t.literal)return t.literal.length?1===t.literal.length||u.config.lexer?t:function(e,t,n){var r=i(e+"$string");return _(r,[{tokens:t.literal.split("").map((function(e){return{literal:e}})),postprocess:{builtin:"joiner"}}],n),r}(e,t,n):null;if(t.token){if(u.config.lexer){var r=t.token;return-1===u.customTokens.indexOf(r)&&u.customTokens.push(r),{token:"("+u.config.lexer+".has("+JSON.stringify(r)+") ? {type: "+JSON.stringify(r)+"} : "+r+")"}}return t}if(t.subexpression)return function(e,t,n){var r=t.subexpression,s=i(e+"$subexpression");return _(s,r,n),s}(e,t,n);if(t.ebnf)return function(e,t,n){switch(t.modifier){case":+":return function(e,t,n){var r=i(e+"$ebnf");return _(r,[{tokens:[t.ebnf]},{tokens:[r,t.ebnf],postprocess:{builtin:"arrpush"}}],n),r}(e,t,n);case":*":return function(e,t,n){var r=i(e+"$ebnf");return _(r,[{tokens:[]},{tokens:[r,t.ebnf],postprocess:{builtin:"arrpush"}}],n),r}(e,t,n);case":?":return function(e,t,n){var r=i(e+"$ebnf");return _(r,[{tokens:[t.ebnf],postprocess:{builtin:"id"}},{tokens:[],postprocess:{builtin:"nuller"}}],n),r}(e,t,n)}}(e,t,n);if(t.macrocall)return function(e,t,n){var r=i(e+"$macrocall"),s=u.macros[t.macrocall];if(!s)throw new Error("Unkown macro: "+t.macrocall);if(s.args.length!==t.args.length)throw new Error("Argument count mismatch.");for(var a={__proto__:n},o=0;o<s.args.length;o++){var p=i(e+"$macrocall");a[s.args[o]]=p,_(p,[t.args[o]],n)}return _(r,s.exprs,a),r}(e,t,n);if(t.mixin){if(n[t.mixin])return g(e,n[t.mixin],n);throw new Error("Unbound variable: "+t.mixin)}throw new Error("unrecognized token: "+JSON.stringify(t))}}},_$compile_2.exports?_$compile_2.exports=n(_$nearley_5):this.Compile=n(this.nearley)}).call(this,_$browser_13,"/node_modules/nearley/lib"),_$compile_2=_$compile_2.exports;var _$generate_3={exports:{}},__root_3,__factory_3;__root_3=this,__factory_3=function(e){function t(e,t,a){return null==a&&(a=""),"[\n    "+e.map((function(e){return function(e,t){var a="{";return a+='"name": '+JSON.stringify(e.name),a+=', "symbols": ['+e.symbols.map(s).join(", ")+"]",e.postprocess&&(e.postprocess.builtin&&(e.postprocess=t[e.postprocess.builtin]),a+=', "postprocess": '+r(n(e.postprocess),"        ",{indentFirst:!1})),a+"}"}(e,t)})).join(",\n    ")+"\n"+a+"]"}function n(e){var t=e.toString().split(/\n/);if(1===t.length)return[t[0].replace(/^\s+|\s+$/g,"")];for(var n=null,r=t.slice(1),s=0;s<r.length;s++){var a=/^\s*/.exec(r[s]);a&&a[0].length!==r[s].length&&(null===n||a[0].length<n.length)&&(n=a[0])}return null===n?t:t.map((function(e){return e.slice(0,n.length)===n?e.slice(n.length):e}))}function r(e,t,n){var r;return r=Array.isArray(e)?e:e.toString().split("\n"),n=n||{},tabulated=r.map((function(e,r){var s=!0;return 0!=r||n.indentFirst||(s=!1),s?t+e:e})).join("\n"),tabulated}function s(e){return e instanceof RegExp?e.toString():e.token?e.token:JSON.stringify(e)}var a=function(e,t){if(e.config.preprocessor||(e.config.preprocessor="_default"),!a[e.config.preprocessor])throw new Error("No such preprocessor: "+e.config.preprocessor);return a[e.config.preprocessor](e,t)};return a.js=a._default=a.javascript=function(e,n){var r="// Generated automatically by nearley, version "+e.version+"\n";return r+="// http://github.com/Hardmath123/nearley\n",r+="(function () {\n",r+="function id(x) { return x[0]; }\n",r+=e.body.join("\n"),r+="var grammar = {\n",r+="    Lexer: "+e.config.lexer+",\n",r+="    ParserRules: "+t(e.rules,a.javascript.builtinPostprocessors)+"\n",r+="  , ParserStart: "+JSON.stringify(e.start)+"\n",r+="}\n",r+="if (typeof module !== 'undefined'&& typeof module.exports !== 'undefined') {\n",r+="   module.exports = grammar;\n",r+="} else {\n",r+="   window."+n+" = grammar;\n",(r+="}\n")+"})();\n"},a.javascript.builtinPostprocessors={joiner:"function joiner(d) {return d.join('');}",arrconcat:"function arrconcat(d) {return [d[0]].concat(d[1]);}",arrpush:"function arrpush(d) {return d[0].concat([d[1]]);}",nuller:"function(d) {return null;}",id:"id"},a.module=a.esmodule=function(e,n){var r="// Generated automatically by nearley, version "+e.version+"\n";return r+="// http://github.com/Hardmath123/nearley\n",r+="function id(x) { return x[0]; }\n",r+=e.body.join("\n"),r+="let Lexer = "+e.config.lexer+";\n",r+="let ParserRules = "+t(e.rules,a.javascript.builtinPostprocessors)+";\n",(r+="let ParserStart = "+JSON.stringify(e.start)+";\n")+"export default { Lexer, ParserRules, ParserStart };\n"},a.cs=a.coffee=a.coffeescript=function(e,s){var o="# Generated automatically by nearley, version "+e.version+"\n";return o+="# http://github.com/Hardmath123/nearley\n",o+="do ->\n",o+="  id = (d) -> d[0]\n",o+=r(n(e.body.join("\n")),"  ")+"\n",o+="  grammar = {\n",o+="    Lexer: "+e.config.lexer+",\n",o+="    ParserRules: "+r(t(e.rules,a.coffeescript.builtinPostprocessors),"      ",{indentFirst:!1})+",\n",o+="    ParserStart: "+JSON.stringify(e.start)+"\n",o+="  }\n",o+="  if typeof module != 'undefined' && typeof module.exports != 'undefined'\n",o+="    module.exports = grammar;\n",(o+="  else\n")+"    window."+s+" = grammar;\n"},a.coffeescript.builtinPostprocessors={joiner:"(d) -> d.join('')",arrconcat:"(d) -> [d[0]].concat(d[1])",arrpush:"(d) -> d[0].concat([d[1]])",nuller:"() -> null",id:"id"},a.ts=a.typescript=function(e,n){var r="// Generated automatically by nearley, version "+e.version+"\n";return r+="// http://github.com/Hardmath123/nearley\n",r+="// Bypasses TS6133. Allow declared but unused functions.\n",r+="// @ts-ignore\n",r+="function id(d: any[]): any { return d[0]; }\n",r+=e.customTokens.map((function(e){return"declare var "+e+": any;\n"})).join(""),r+=e.body.join("\n"),r+="\n",r+="interface NearleyToken {",r+="  value: any;\n",r+="  [key: string]: any;\n",r+="};\n",r+="\n",r+="interface NearleyLexer {\n",r+="  reset: (chunk: string, info: any) => void;\n",r+="  next: () => NearleyToken | undefined;\n",r+="  save: () => any;\n",r+="  formatError: (token: NearleyToken) => string;\n",r+="  has: (tokenType: string) => boolean;\n",r+="};\n",r+="\n",r+="interface NearleyRule {\n",r+="  name: string;\n",r+="  symbols: NearleySymbol[];\n",r+="  postprocess?: (d: any[], loc?: number, reject?: {}) => any;\n",r+="};\n",r+="\n",r+="type NearleySymbol = string | { literal: any } | { test: (token: any) => boolean };\n",r+="\n",r+="interface Grammar {\n",r+="  Lexer: NearleyLexer | undefined;\n",r+="  ParserRules: NearleyRule[];\n",r+="  ParserStart: string;\n",r+="};\n",r+="\n",r+="const grammar: Grammar = {\n",r+="  Lexer: "+e.config.lexer+",\n",r+="  ParserRules: "+t(e.rules,a.typescript.builtinPostprocessors,"  ")+",\n",r+="  ParserStart: "+JSON.stringify(e.start)+",\n",r+="};\n",(r+="\n")+"export default grammar;\n"},a.typescript.builtinPostprocessors={joiner:"(d) => d.join('')",arrconcat:"(d) => [d[0]].concat(d[1])",arrpush:"(d) => d[0].concat([d[1]])",nuller:"() => null",id:"id"},a},_$generate_3.exports?_$generate_3.exports=__factory_3(_$nearley_5):__root_3.generate=__factory_3(__root_3.nearley),_$generate_3=_$generate_3.exports;const grammar=_$nearleyLanguageBootstrapped_4({});class Nearley{constructor({ParserRules:e,ParserStart:t},n){const r=n||t;this.parser=new _$nearley_5.Parser(e,r,{keepHistory:!0})}feed(e){try{return this.parser.feed(e),this.parser.results}catch(t){throw this.reportError(t)}}static compile(source,raw=!1){const parser=new _$nearley_5.Parser(grammar);parser.feed(source);const ast=parser.results[0],info=_$compile_2(ast,{}),code=_$generate_3(info,"grammar");if(raw)return code;const module={exports:{}};return eval(code),module.exports}static from(e,t){return new Nearley(Nearley.compile(e),t)}reportError(e){let{parser:t}=this;const n=t.table.length-2,r=t.table[n];let s={token:t.lexer.buffer[t.current],expected:[],message:e.message};for(let a=0;a<r.states.length;a++){const e=r.states[a],o=e.rule.symbols[e.dot];if(o&&this.isTerminalSymbol(o)){let e={symbol:this.getSymbolDisplay(o),based:[]};s.expected.push(e);const r=this.buildStateStack(n,a,t);for(let t=0;t<r.length;t++){const n=r[t];e.based.push(n.rule.toString(n.dot))}}}return s}getSymbolDisplay(e){const t=typeof e;if("string"===t)return e;if("object"===t&&e.literal)return JSON.stringify(e.literal);if("object"===t&&e instanceof RegExp)return"character matching "+e;throw new Error("Unknown symbol type: "+e)}buildStateStack(e,t,n){const r=n.table[e].states[t];if(0===r.dot){const s=this.findPreviousStateWhere(e=>{const t=e.rule.symbols[e.dot];return t&&this.isNonTerminalSymbol(t)&&r.rule.name===t},e,t,n);return s?[r,...this.buildStateStack(s[0],s[1],n)]:[r]}{const e=n.table[r.reference].states.map((e,t)=>[e,t]).filter(([e,t])=>e.rule.toString()===r.rule.toString())[0];return[r,...this.buildStateStack(r.reference,e[1],n)]}}findPreviousStateWhere(e,t,n,r){let s,a=t,o=n,i=r.table[a];for(;;){if(--o<0){if(--a<0)return null;o=(i=r.table[a]).states.length-1}if(e(s=i.states[o]))return[a,o,s]}}isTerminalSymbol(e){return"string"!=typeof e}isNonTerminalSymbol(e){return!this.isTerminalSymbol(e)}}function bind(e,t={},n=[]){return(r,s,a)=>{let o=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(r)).filter(e=>null!=e),u=n.filter(e=>"null"!=e["@type"]),p=`${e}${JSON.stringify(o)} -> `;for(let e of u)p+=`${e["@type"]||e}${JSON.stringify(e.types||{})} `;let l=p.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0),c=i.filter(e=>e["@type"]);if(u.length!=c.length)return a;let f={};for(let e=0;e<u.length;e++){let t=u[e],n=c[e];if(t["@type"]!=n["@type"])return a;for(let[e,r]of Object.entries(t.types||{}))if("number"==typeof r){if(f[r])if(Array.isArray(f[r])){if(!f[r].includes(n.types[e]))return a}else if("number"==typeof f[r])f[r]=n.types[e];else{if(Array.isArray(n.types[e])){if(!n.types[e].includes(f[r]))return a;continue}if("number"==typeof n.types[e]){f[n.types[e]]=f[r];continue}if(f[r]!=n.types[e])return a}f[r]=n.types[e]}else if("number"==typeof n.types[e])n.types[e]=r;else if(Array.isArray(n.types[e])){if(!n.types[e].includes(t.types[e]))return a;n.types[e]=t.types[e]}else{if("string"==typeof n.types[e]&&t.types[e]!=n.types[e]){if(Array.isArray(t.types[e])&&t.types[e].includes(n.types[e]))continue;return a}if(!n.types[e])return a}}for(let[e,t]of Object.entries(o))"number"==typeof t&&(f[t]?o[e]=f[t]:o[e]=l+t);let h={"@type":e,types:o,children:i};return null!=s&&(h.loc=s),h}}const RuntimeSyntax='\n      @builtin "whitespace.ne"\n      @builtin "number.ne"\n      @builtin "string.ne"\n\n      rules -> (_ rule _ "."):+ _ {% ([rules]) => {\n        return rules.map(([ws, rule]) => rule);\n      } %}\n\n      rule -> head __ "->" __ tail {%\n        ([head, ws0, arrow, ws1, tail]) => {\n         return {\n          "head": head,\n          "tail": tail\n         }\n        }\n      %}\n\n      head -> name {% id %}\n      tail -> (term __ {% id %}):* term {%\n        ([beginning, end]) => {\n         return [...beginning, end];\n        }\n      %}\n\n      term -> name {% id %}\n      term -> string {% id %}\n\n      name -> word features:? {% \n        ([word, features]) => {\n         return {\n          name: word,\n          types: Object.fromEntries(features || [])\n         }\n        }\n      %}\n      string -> dqstring {% ([str]) => \'"\' + str + \'"\' %}\n\n      features -> "[" props "]" {% ([p0, props, p1]) => {\n        // console.log(props);\n        return props;\n      }%}\n\n      props -> (keyvalue _ "," _ {% id %}):* keyvalue:? {%\n        ([beginning, end]) => {\n         if (!end) {\n          return beginning;\n         }\n         return [...beginning, end];\n        }\n      %}\n\n      keyvalue -> word _ "=" _ word {% \n        ([key, ws0, eq, ws1, value]) => {\n         return [key, value];\n        }\n      %}\n\n      keyvalue -> word _ "=" _ int {% \n        ([key, ws0, eq, ws1, value]) => {\n         return [key, value];\n        }\n      %}\n\n      keyvalue -> word _ "=" _ array {% \n        ([key, ws0, eq, ws1, value]) => {\n         return [key, value];\n        }\n      %}\n\n      array -> "[" values "]" {% ([p0, values, p1]) => values %}\n\n      values -> (word _ "," _ {% id %}):* word:? {%\n        ([beginning, end]) => {\n         if (!end) {\n          return beginning;\n         }\n         return [...beginning, end];\n        }\n      %}\n\n      word -> [a-zA-Z_+-]:+ {% ([char]) => {\n        return char.join("");\n      }%}\n';let RuntimeGrammar;function runtimeGrammar(){return RuntimeGrammar||(RuntimeGrammar=Nearley.compile(RuntimeSyntax)),RuntimeGrammar}class FeaturedNearley{constructor(){this.parser=new Nearley(runtimeGrammar())}feed(e){return this.parser.feed(e)}static compile(e,t,n){let r=(new FeaturedNearley).feed(e),s=[];function a(e){s.push(e)}a('@builtin "whitespace.ne"'),a(""),a("@{%"),a(""+bind.toString()),a("%}"),a(""),t&&a(t);for(let{head:o,tail:i}of r[0]){let e=e=>"string"==typeof e?e+"i":e.name;a(`${o.name} -> ${i.map(e).join(" ")} {%`),a(`  bind("${o.name}", ${JSON.stringify(o.types)}, [`);for(let t of i)"_"!=t.name&&"__"!=t.name&&"string"!=typeof t&&a(`    {"@type": "${t.name}", "types": ${JSON.stringify(t.types)}}, `);a("  ])"),a("%}")}return Nearley.compile(s.join("\n"),n)}}const DrtSyntax='\n      Sentence -> _ Statement _.\n      Sentence -> _ Question _.      \n\n      Statement -> S_ _ ".".\n\n      Question ->\n          "Who" __\n          VP_[num=1, fin=+, gap=-, tp=3, tense=4] _\n          "?"\n          .\n\n      Question ->\n          "Who" __ \n          AUX[num=1, fin=+, tp=2, tense=3] __\n          NP[num=1, gen=4, case=+nom, gap=-] __\n          V[num=1, fin=-, trans=+] _\n          "?"\n          .\n\n      Question ->\n          BE[num=1, fin=+, tp=2, tense=3] __\n          NP[num=1, gen=4, case=+nom, gap=-] __\n          ADJ _\n          "?"\n          .\n\n      S_[num=1, gap=-, tp=2, tense=3] -> S[num=1, gap=-, tp=2, tense=3].\n\n      S[num=1, gap=-, tp=2, tense=3] -> \n          "if" __ \n          S[num=1, gap=-, tp=2, tense=3] __ \n          "then" __ \n          S[num=1, gap=-, tp=2, tense=3].\n\n      S[num=1, gap=-, tp=2, tense=3] -> \n          S[num=4, gap=-, tp=2, tense=3] __ \n          "and" __ \n          S[num=5, gap=-, tp=2, tense=3].\n\n      S[num=1, gap=-, tp=2, tense=3] -> \n          S[num=4, gap=-, tp=2, tense=3] __ \n          "or" __ \n          S[num=5, gap=-, tp=2, tense=3].\n\n      S[num=1, gap=-, tp=3, tense=4] -> \n          NP[num=1, gen=2, case=+nom, gap=-] __ \n          VP_[num=1, fin=+, gap=-, tp=3, tense=4].\n\n      S[num=1, gap=np, tp=3, tense=4] ->\n          NP[num=1, gen=2, case=+nom, gap=np] _ \n          VP_[num=1, fin=+, gap=-, tp=3, tense=4].\n\n      S[num=1, gap=np, tp=3, tense=4] ->\n          NP[num=1, gen=2, case=+nom, gap=-] __ \n          VP_[num=1, fin=+, gap=np, tp=3, tense=4].\n\n      VP_[num=1, fin=+, gap=2, stat=3, tp=4, tense=fut] ->\n        AUX[num=1, fin=+, tp=4, tense=fut] __ \n        VP[num=5, fin=-, gap=2, stat=3, tp=4, tense=pres].\n\n      VP_[num=1, fin=+, gap=2, stat=4, tp=5, tense=6] ->\n        AUX[num=1, fin=+, tp=5, tense=6] __ \n        "not" __ \n        VP[num=3, fin=-, gap=2, stat=4, tp=5, tense=6].\n\n      VP_[num=1, fin=+, gap=2, state=3, tp=4, tense=5] -> \n          VP[num=1, fin=+, gap=2, state=3, tp=4, tense=5].\n\n      VP[num=1, fin=2, gap=-, stat=3, tp=4, tense=5] ->\n          V[num=1, fin=2, trans=+, stat=3, tp=4, tense=5] __ \n          NP[num=6, gen=7, case=-nom, gap=-].\n\n      VP[num=1, fin=2, gap=np, tp=6, tense=7] ->\n          V[num=1, fin=2, trans=+, tp=6, tense=7] _ \n          NP[num=4, gen=5, case=-nom, gap=np].\n\n      VP[num=1, fin=2, gap=-, stat=3, tp=4, tense=5] -> \n        V[num=1, fin=2, trans=-, stat=3, tp=4, tense=5].\n\n      VP[num=1, fin=+, gap=2, stat=+, tp=4, tense=5] -> \n          HAVE[num=1, fin=+, tp=4, tense=5] __\n          VP[num=1, fin=part, gap=2, stat=6, tp=4, tense=5].\n\n      VP[num=1, fin=+, gap=2, stat=+, tp=4, tense=5] -> \n          HAVE[num=1, fin=+, tp=4, tense=5] __\n          "not" __\n          VP[num=1, fin=part, gap=2, stat=6, tp=4, tense=5].\n\n      NP[num=1, gen=2, case=3, gap=np] -> GAP.\n\n      GAP -> null.\n\n      NP[num=1, gen=2, case=3, gap=-] -> DET[num=1] __ N[num=1, gen=2].\n\n      NP[num=1, gen=2, case=3, gap=-] -> DET[num=1] __ RN[num=1, gen=2].\n\n      NP[num=1, gen=2, case=3, gap=-] -> PN[num=1, gen=2].\n \n      NP[num=1, gen=2, case=3, gap=-] -> PRO[num=1, gen=2, case=3].\n\n      NP[num=plur, gen=1, case=2, gap=-] -> \n        NP[num=3, gen=4, case=2, gap=-] __ \n        "and" __ \n        NP[num=5, gen=6, case=2, gap=-].\n\n      NP[num=3, gen=1, case=2, gap=-] -> \n        NP[num=3, gen=4, case=2, gap=-] __ \n        "or" __ \n        NP[num=3, gen=6, case=2, gap=-].\n\n      N[num=1, gen=2] -> N[num=1, gen=2] __ RC[num=1, gen=2].\n\n      RC[num=1, gen=2] -> RPRO[num=1, gen=2] __ S[num=1, gap=np].\n\n      VP[num=1, fin=2, gap=-, stat=+, tp=-past, tense=4] -> \n          BE[num=1, fin=2, tp=-past, tense=4] __ ADJ.\n      VP[num=1, fin=2, gap=-, stat=+, tp=-past, tense=4] -> \n          BE[num=1, fin=2, tp=-past, tense=4] __ "not" __ ADJ.\n\n      VP[num=1, fin=2, gap=-, stat=+, tp=-past, tense=4] -> \n          BE[num=1, fin=2, tp=-past, tense=4] __ PP.\n      VP[num=1, fin=2, gap=-, stat=+, tp=-past, tense=4] -> \n          BE[num=1, fin=2, tp=-past, tense=4] __ "not" __ PP.\n\n      VP[num=1, fin=2, gap=-, stat=+, tp=-past, tense=7] -> \n          BE[num=1, fin=2, tp=-past, tense=7] __ \n          NP[num=3, gen=4, case=5, gap=-].\n\n      VP[num=1, fin=2, gap=-, stat=+, tp=-past, tense=7] -> \n          BE[num=1, fin=2, tp=-past, tense=7] __ \n          "not" __ \n          NP[num=3, gen=4, case=5, gap=-].\n\n      DET[num=sing] -> "a".\n      DET[num=sing] -> "an".\n      DET[num=sing] -> "every".\n      DET[num=sing] -> "the".\n      DET[num=sing] -> "some".\n\n      DET[num=1] -> NP[num=2, gen=3, case=+nom, gap=-] _ "\'s".\n\n      N[num=1, gen=2] -> ADJ __ N[num=1, gen=2].\n\n      PRO[num=sing, gen=male, case=+nom] -> "he".\n      PRO[num=sing, gen=male, case=-nom] -> "him".\n\n      PRO[num=sing, gen=fem, case=+nom] -> "she".\n      PRO[num=sing, gen=fem, case=-nom] -> "her".\n\n      PRO[num=sing, gen=-hum, case=[-nom, +nom]] -> "it".\n\n      PRO[num=plur, gen=[male, fem, -hum], case=+nom] -> "they".\n      PRO[num=plur, gen=[male, fem, -hum], case=-nom] -> "them".\n\n      PRO[num=sing, gen=male, case=-nom, refl=+] -> "himself".\n      PRO[num=sing, gen=fem, case=-nom, refl=+] -> "herself".\n      PRO[num=sing, gen=-hum, case=-nom, refl=+] -> "itself".\n\n      N[num=1, gen=2] -> N[num=1, gen=2] __ PP.\n\n      PP -> PREP __ NP[num=1, gen=2, case=3, gap=-].\n\n      PREP -> "behind".\n      PREP -> "in".\n      PREP -> "over".\n      PREP -> "under".\n      PREP -> "near".\n\n      PREP -> "before".\n      PREP -> "after".\n      PREP -> "during".\n\n      PREP -> "from".\n      PREP -> "to".\n      PREP -> "of".\n      PREP -> "about".\n      PREP -> "by".\n      PREP -> "for".\n      PREP -> "with".\n\n      AUX[num=sing, fin=+, tp=-past, tense=pres] -> "does".\n      AUX[num=plur, fin=+, tp=-past, tense=pres] -> "do".\n\n      AUX[num=1, fin=+, tp=-past, tense=past] -> "did".\n      AUX[num=1, fin=+, tp=+past, tense=pres] -> "did".\n\n      AUX[num=1, fin=+, tp=-past, tense=fut] -> "will".\n      AUX[num=1, fin=+, tp=+past, tense=fut] -> "would".\n\n      RPRO[num=[sing, plur], gen=[male, fem]] -> "who".\n      RPRO[num=[sing, plur], gen=-hum] -> "which".\n\n      BE[num=sing, fin=+, tp=-past, tense=pres] -> "is".\n      BE[num=plur, fin=+, tp=-past, tense=pres] -> "are".\n\n      BE[num=sing, fin=+, tp=-past, tense=past] -> "was".\n      BE[num=plur, fin=+, tp=-past, tense=past] -> "were".\n\n      BE[num=sing, fin=+, tp=+past, tense=pres] -> "was".\n      BE[num=plur, fin=+, tp=+past, tense=pres] -> "were".\n\n      BE[fin=-] -> "be".\n      BE[fin=part] -> "been".\n\n      HAVE[fin=-1] -> "have".\n\n      HAVE[num=sing, fin=+, tp=-past, tense=pres] -> "has".\n      HAVE[num=plur, fin=+, tp=-past, tense=pres] -> "have".\n\n      HAVE[num=1, fin=+, tp=-past, tense=past] -> "had".\n      HAVE[num=1, fin=+, tp=+past, tense=[pres, past]] -> "had".\n\n      V[num=1, fin=-, stat=-, trans=2] -> \n          VERB[trans=2, stat=-].\n\n      V[num=sing, fin=+, stat=1, tp=-past, tense=pres, trans=2] -> \n          VERB[trans=2, stat=1, pres=+s] "s".\n\n      V[num=sing, fin=+, stat=1, tp=-past, tense=pres, trans=2] -> \n          VERB[trans=2, stat=1, pres=+es] "es".\n\n      V[num=sing, fin=+, stat=1, tp=-past, tense=pres, trans=2] -> \n          VERB[trans=2, stat=1, pres=+ies] "ies".\n\n      V[num=plur, fin=+, stat=1, tp=-past, tense=pres, trans=2] -> \n          VERB[trans=2, stat=1].\n\n      V[num=1, fin=part, stat=2, tp=-past, tense=[pres, past], trans=3] \n          -> VERB[trans=3, stat=2, past=+ed] "ed".\n\n      V[num=1, fin=+, stat=2, tp=+past, tense=past, trans=3] \n          -> VERB[trans=3, stat=2, past=+ed] "ed".\n\n      V[num=1, fin=part, stat=2, tp=-past, tense=[pres, past], trans=3] \n          -> VERB[trans=3, stat=2, past=+d] "d".\n\n      V[num=1, fin=+, stat=2, tp=+past, tense=past, trans=3] \n          -> VERB[trans=3, stat=2, past=+d] "d".\n\n      V[num=1, fin=[+, part], stat=2, tp=-past, tense=[pres, past], trans=3] \n         -> VERB[trans=3, stat=2, past=+ied] "ied".\n\n      V[num=1, fin=[+, part], stat=2, tp=-past, tense=[pres, past], trans=3] \n         -> VERB[trans=3, stat=2, past=+led] "led".\n\n      V[num=1, fin=[+, part], stat=2, tp=-past, tense=[pres, past], trans=3] \n         -> VERB[trans=3, stat=2, past=+red] "red".\n\n      V[num=1, fin=[+, part], stat=2, tp=-past, tense=[pres, past], trans=3] \n         -> VERB[trans=3, stat=2, past=-reg].\n\n\n      ADJ -> "happy".\n      ADJ -> "unhappy".\n      ADJ -> "foolish".\n      ADJ -> "fast".\n      ADJ -> "beautiful".\n      ADJ -> "mortal".\n      ADJ -> "brazilian".\n\n      PN[num=sing, gen=male] -> "Socrates".\n      PN[num=sing, gen=male] -> "Jones".\n      PN[num=sing, gen=male] -> "John".\n      PN[num=sing, gen=male] -> "Smith".\n      PN[num=sing, gen=fem] -> "Mary".\n      PN[num=sing, gen=-hum] -> "Brazil".\n      PN[num=sing, gen=-hum] -> "Ulysses".\n\n      N[num=sing, gen=male] -> "man".\n      N[num=sing, gen=fem] -> "woman".\n      N[num=sing, gen=fem] -> "girl".\n      N[num=sing, gen=-hum] -> "book".\n      N[num=sing, gen=-hum] -> "telescope".\n      N[num=sing, gen=-hum] -> "donkey".\n      N[num=sing, gen=-hum] -> "horse".\n      N[num=sing, gen=-hum] -> "porsche".\n      N[num=sing, gen=[male, fem]] -> "engineer".\n      N[num=sing, gen=1] -> "brazilian".\n\n      RN[num=sing, gen=male] -> "brother".\n      RN[num=sing, gen=male] -> "father".\n      RN[num=sing, gen=male] -> "husband".\n      RN[num=sing, gen=fem] -> "sister".\n      RN[num=sing, gen=fem] -> "mother".\n      RN[num=sing, gen=fem] -> "wife".\n\n      VERB[trans=+, stat=-, pres=+s, past=+ed] -> "beat".\n      VERB[trans=1, stat=-, pres=+s, past=+ed] -> "listen".\n      VERB[trans=+, stat=-, pres=+s, past=+ed] -> "own".\n\n      VERB[trans=1, stat=-, pres=+s, past=+ed] -> "listen".\n\n      VERB[trans=-, stat=-, pres=+s, past=+ed] -> "walk".\n      VERB[trans=-, stat=-, pres=+s, past=+ed] -> "sleep".\n      VERB[trans=-, stat=-, pres=+s, past=+ed] -> "stink".\n\n      VERB[trans=1, stat=-, pres=+s] -> "leave".\n      VERB[trans=1, stat=-, past=-reg] -> "left".\n\n      VERB[trans=-, stat=-, pres=+s] -> "come".\n      VERB[trans=-, stat=-, past=-reg] -> "came".\n\n      VERB[trans=+, stat=-, pres=+es, past=+ed] -> "kiss".\n      VERB[trans=+, stat=-, pres=+es, past=+ed] -> "box".\n      VERB[trans=+, stat=-, pres=+es, past=+ed] -> "watch".\n      VERB[trans=+, stat=-, pres=+es, past=+ed] -> "crash".\n\n      VERB[trans=+, stat=-, pres=+s, past=+d] -> "like".\n      VERB[trans=+, stat=-, pres=+s, past=+d] -> "seize".\n      VERB[trans=+, stat=-, pres=+s, past=+d] -> "tie".\n      VERB[trans=+, stat=-, pres=+s, past=+d] -> "free".\n      VERB[trans=1, stat=-, pres=+s, past=+d] -> "love".\n      VERB[trans=+, stat=-, pres=+s, past=+d] -> "surprise".\n      VERB[trans=+, stat=-, pres=+s, past=+d] -> "fascinate".\n      VERB[trans=+, stat=-, pres=+s, past=+d] -> "admire".\n\n      VERB[trans=-, stat=-, pres=+s, past=+ed] -> "ski".\n      VERB[trans=-, stat=-, pres=+s, past=+ed] -> "echo".\n\n      VERB[trans=-, stat=-, pres=+s, past=+ed] -> "play".\n      VERB[trans=-, stat=-, pres=+s, past=+ed] -> "decay".\n      VERB[trans=+, stat=-, pres=+s, past=+ed] -> "enjoy".\n\n      VERB[trans=-, stat=-, pres=+ies, past=+ied] -> "cr".\n      VERB[trans=-, stat=-, pres=+ies, past=+ied] -> "appl".\n      VERB[trans=+, stat=-, pres=+ies, past=+ied] -> "cop".\n      VERB[trans=-, stat=-, pres=+ies, past=+ied] -> "repl".\n      VERB[trans=-, stat=-, pres=+ies, past=+ied] -> "tr".\n\n      VERB[trans=-, stat=-, pres=+s, past=+led] -> "compel".\n      VERB[trans=-, stat=-, pres=+s, past=+red] -> "defer".\n';let DRTGrammar;function drtGrammar(){return DRTGrammar||(DRTGrammar=FeaturedNearley.compile(DrtSyntax,"Discourse -> Sentence:+")),DRTGrammar}class Parser{constructor(e){this.parser=new Nearley(drtGrammar(),e)}feed(e){return this.parser.feed(e)}}let node=e=>(...t)=>({"@type":e,children:t});function parse(e,t="Statement"){return new Parser(t).feed(e)}function child(e,...t){let n=e;for(let r of t)n=n.children[r];return n}function first(e){return preprocess(child(e[0],0,0))}function preprocess(e){if("V"==e["@type"]){let t=e.children[0].children[0],n=e.children[1]||"";return e.children=[t+n],e}for(let t of e.children||[])preprocess(t);return e}var _$parser_9={parse:parse,first:first,nodes:{Statement:node("Statement"),Sentence:node("Sentence"),Question:node("Question"),S:node("S"),S_:node("S_"),NP:node("NP"),PN:node("PN"),VP_:node("VP_"),VP:node("VP"),V:node("V"),AUX:node("AUX"),PRO:node("PRO"),DET:node("DET"),N:node("N"),RC:node("RC"),RPRO:node("RPRO"),GAP:node("GAP"),BE:node("BE"),ADJ:node("ADJ"),PREP:node("PREP"),PP:node("PP"),VERB:node("VERB"),HAVE:node("HAVE"),RN:node("RN")}};function time({types:e}){let{tense:t}=e||{};return"fut"==t?"> ":"past"==t?"< ":""}var _$base_6={clone:function(e){return JSON.parse(JSON.stringify(e))},print:function e(t,n){if("string"==typeof t)return t;if("Predicate"==t["@type"])return time(t)+t.print();if("Referent"==t["@type"])return n?n.find(e=>e.name==t.name).value:t.name;let r=(t.children||[]).map(t=>e(t,n)),s="S"==t["@type"]?time(t):"",a=t.ref?`(${t.ref.name})`:"";return s+r.join(" ").trim()+a},child:function(e,...t){let n=e;for(let r of t)n=n.children[r];return n}};const{clone:clone,print:print}=_$base_6,{parse:__parse_8}=_$parser_9;class DRS{constructor([e,t]){this.head=[],this.body=[],this.names=e,this.rules=t}feed(e){let[[t]]=__parse_8(e,"Discourse");for(let n of t)this.push(n);return this}bind(e){let t=[e];for(;t.length>0;){let e=t.shift(),[n,r]=this.names.match(e,this.head);this.head.push(...n),this.body.push(...r);let s=(e.children||[]).filter(e=>"string"!=typeof e);t.push(...s)}}push(e){for(let n of this.head)n.loc=0;this.bind(e);let t=[e];for(this.body.push(e);t.length>0;){let e=t.shift(),n=!1;for(let s of this.rules){let[r,a,o,[i]]=s.match(e,this.head);if(this.head.push(...r),this.body.push(...a),i){n=!0;let e=this.body.indexOf(i);if(-1==e)throw new Error("Ooops, deleting an invalid node.");this.body.splice(e,1)}if(t.push(...a.filter(e=>!(e instanceof DRS))),n)break}if(n)continue;let r=(e&&e.children||[]).filter(e=>"string"!=typeof e);t.push(...r)}return this}print(){let e=[],t=[],n=this.head.filter(e=>!e.closure);for(let a of n)t.push(""+a.print());let r=t.join(", "),s=this.neg?"~":"";e.push(`${s}drs(${r}) {`);for(let a of this.body)a instanceof DRS||"Implication"==a["@type"]||"Negation"==a["@type"]||"Query"==a["@type"]||"Conjunction"==a["@type"]||"Disjunction"==a["@type"]?e.push(a.print()):e.push(print(a));return e.push("}"),e.join("\n")}}var _$drs_8={DRS:DRS};const{clone:__clone_10,print:__print_10,child:__child_10}=_$base_6,{parse:__parse_10,first:__first_10,nodes:nodes}=_$parser_9,{DRS:__DRS_10}=_$drs_8,{S:S,S_:S_,NP:NP,NP_:NP_,PN:PN,VP_:VP_,VP:VP,V:V,BE:BE,DET:DET,N:N,RN:RN,PRO:PRO,AUX:AUX,RC:RC,RPRO:RPRO,GAP:GAP,ADJ:ADJ,PP:PP,PREP:PREP,HAVE:HAVE,VERB:VERB,Discourse:Discourse,Sentence:Sentence,Statement:Statement,Question:Question}=nodes;let capture=e=>({"@type":"Match",name:e});function match(e,t){if(!e||!t)return!1;if(e["@type"]!=t["@type"])return!1;let n={};for(let r=0;r<e.children.length;r++)if("string"==typeof e.children[r]){if(e.children[r].toLowerCase()!=String(t.children[r]).toLowerCase())return!1}else{if("Match"==e.children[r]["@type"]){n[e.children[r].name]=t;continue}{let s=match(e.children[r],t.children[r]);if(!s)return!1;n=Object.assign(n,s)}}return n}class Ids{constructor(){this.gen=function*(){let e=0;for(;;){let t=e%26,n=Math.floor(e/26);yield`${String.fromCharCode(97+t)}${n>0?n:""}`,e++}}()}get(e){return e?(this.id=null==this.id?0:this.id+1,`${e}${this.id}`):this.gen.next().value}}class Rule{constructor(e,t){this.ids=e||new Ids,this.trigger=t}match(e,t){let n=match(this.trigger,e);return n?this.apply(n,e,t):[[],[],[],[]]}id(e){return this.ids.get(e)}}class CompositeRule extends Rule{constructor(e){super(),this.rules=e}match(e,t){let n=[[],[],[],[]];for(let r of this.rules){let[s,a,o,i]=r.match(e,t);n[0].push(...s),n[1].push(...a),n[2].push(...o),n[3].push(...i)}return n}}function find({gen:e,num:t},n,r,s,a=[]){let o=n=>{let o=!r||n.value==r,i=n.types||{};return!(!o||i.num!=t||n.loc>s||a.map(e=>e.name).includes(n.name)||("?"==i.gen?(i.gen=e,0):i.gen!=e))};for(let i=n.length-1;i>=0;i--)if(o(n[i]))return n[i]}function referent(e,t,n,r){return{"@type":"Referent",types:t,name:e,value:n,loc:r,print(){return""+this.name}}}class CRSPN extends Rule{constructor(e){super(e,S(NP(PN(capture("name"))),VP_()))}apply({name:e},t,n=[]){let r=[],s=[],a=find(e.types,n,__print_10(e.children[0]),e.loc);if(!a){a=referent(this.id(),e.types,__print_10(e,n),e.loc),r.push(a);let t=e;t.ref=a,s.push(t)}return t.children[0]=a,[r,s,[],[]]}}class CRVPPN extends Rule{constructor(e){super(e,VP(capture("v"),NP(PN(capture("name")))))}apply({name:e},t,n=[]){let r=[],s=[],a=find(e.types,n,e.children[0],e.loc);if(!a){a=referent(this.id(),e.types,e.children[0],e.loc),r.push(a);let t=e;t.ref=a,s.push(t)}return t.children[1].children[0]=a,[r,s,[],[]]}}class CRDETPN extends Rule{constructor(e){super(e,DET(NP(PN(capture("name"))),"'s"))}apply({name:e},t,n){let r=[],s=[],a=find(e.types,n,e.children[0]);if(!a){a=referent(this.id(),e.types,__print_10(e)),r.push(a);let t=e;t.ref=a,s.push(t)}return t.children[0]=a,[r,s,[],[]]}}class CRPPPN extends Rule{constructor(e){super(e,PP(PREP(),NP(PN(capture("name")))))}apply({name:e},t,n){let r=[],s=[],a=find(e.types,n,e.children[0]);if(!a){a=referent(this.id(),e.types,__print_10(e)),r.push(a);let t=e;t.ref=a,s.push(t)}return t.children[1]=a,[r,s,[],[]]}}class CRPN extends CompositeRule{constructor(e){super([new CRSPN(e),new CRVPPN(e),new CRDETPN(e),new CRPPPN(e)])}}class CRSPRO extends Rule{constructor(e){super(e,S(NP(PRO(capture("pronoun"))),VP_(capture("?"))))}apply({pronoun:e},t,n){let r=find(e.types,n,void 0,e.loc);if(!r)throw new Error("Invalid reference: "+e.children[0]);return t.children[0]=r,[[],[],[],[]]}}class CRVPPRO extends Rule{constructor(e){super(e,S(capture("sub"),VP_(VP(V(),NP(PRO(capture("pro")))))))}apply({sub:e,pro:t},n,r){let s="-"==t.types.refl?[__child_10(e,0)]:[],a=find(t.types,r,void 0,void 0,s);if(!a)throw new Error("Invalid Reference: "+t.children[0]);return __child_10(n,1,0).children[1]=a,[[],[],[],[]]}}class CRPRO extends CompositeRule{constructor(e){super([new CRSPRO(e),new CRVPPRO(e)])}}class CRSID extends Rule{constructor(e){super(e,S(NP(DET(capture("det")),N(capture("noun"))),VP_()))}apply({det:e,noun:t},n,r){if("string"!=typeof e.children[0]||"a"!=e.children[0].toLowerCase())return[[],[],[],[]];let s=referent(this.id(),t.types,__print_10(__child_10(n,0),r));return t.ref=s,n.children[0]=s,[[s],[t],[],[]]}}class CRVPID extends Rule{constructor(e){super(e,VP(V(),NP(DET(capture("det")),N(capture("noun")))))}apply({det:e,noun:t},n,r){if("a"!=e.children[0]&&"an"!=e.children[0])return[[],[],[],[]];let s=__clone_10(t.types);Object.assign(s,__child_10(t,0).types);let a=referent(this.id(),s,__print_10(__child_10(n,1),r));return t.ref=a,n.children[1]=a,[[a],[t],[],[]]}}class CRID extends CompositeRule{constructor(e){super([new CRSID(e),new CRVPID(e)])}}class CRNLIN extends Rule{constructor(e){super(e,N(capture("noun")))}apply({noun:e},t){return t.ref&&1==t.children.length?[[],[(n=__child_10(e,0),r=[t.ref],s=t.types,{"@type":"Predicate",name:n,args:r,types:s,print(){let e=this.args.map(e=>__print_10(e));return`${this.name}(${e.join(", ")})`}})],[],[t]]:[[],[],[],[]];var n,r,s}}class CRPPLIN extends Rule{constructor(e){super(e,N(N(capture("noun")),PP(PREP(capture("prep")),capture("np"))))}apply({noun:e,prep:t,np:n},r){return r.ref?(e.ref=r.ref,[[],[e,S(r.ref,VP_(VP(V(t),__child_10(n,1))))],[],[r]]):[[],[],[],[]]}}class CRLIN extends CompositeRule{constructor(e){super([new CRNLIN(e),new CRPPLIN(e)])}}class CRNRC extends Rule{constructor(e){super(e,N(N(),RC(capture("rc"))))}apply(e,t){let n=[],r=[],s=t.children.pop().children[1];match(S(NP(),VP_(AUX(),"not",VP(V(),NP(GAP(capture("gap")))))),s)&&(__child_10(s,1,2,1).children[0]=t.ref);let a=__child_10(s,1,0,1);a&&"GAP"==a.children[0]["@type"]&&(a.children[0]=t.ref);let o=s.children[0];o&&o.children&&"GAP"==o.children[0]["@type"]&&(s.children[0]=t.ref);let i=t.children.pop();return i.ref=t.ref,n.push(i),r.push(t),n.push(s),[[],n,[],r]}}class CRNEG extends Rule{constructor(e){super(e,S(capture("np"),VP_(AUX(),"not",VP(capture("vp")))))}apply({np:e,vp:t},n,r){let s=drs(this.ids);s.head=__clone_10(r),s.head.forEach(e=>e.closure=!0),s.neg=!0;let a=__clone_10(n);return __child_10(a,1).children.splice(0,2),s.push(a),[[],[s],[],[n]]}}class CRPOSBE extends Rule{constructor(e){super(e,S(capture("ref"),VP_(VP(BE(),ADJ(capture("adj"))))))}apply({ref:e,adj:t},n,r){let s=S(t);return t.ref=e.children[0],s.types=n.types,[[],[s],[],[n]]}}class CRPREPBE extends Rule{constructor(e){super(e,S(capture("ref"),VP_(VP(BE("is"),PP(PREP(capture("prep")),capture("np"))))))}apply({ref:e,prep:t,np:n},r,s){return[[],[S(__child_10(e,0),VP_(VP(V(__child_10(t,0)),__child_10(n,1))))],[],[r]]}}class CRNEGBE extends Rule{constructor(e){super(e,S(capture("ref"),VP_(VP(BE(),"not",ADJ(capture("adj"))))))}apply({ref:e,adj:t},n,r){let s=drs(this.ids);s.head=__clone_10(r),s.head.forEach(e=>e.closure=!0);let a=S(e.children[0],VP_(VP(BE(),t)));return a.types=n.types,s.push(a),[[],[negation(s)],[],[n]]}}class CRNBE extends Rule{constructor(e){super(e,S(capture("ref"),VP_(VP(BE(),NP(DET(capture("det")),N(capture("noun")))))))}apply({ref:e,det:t,noun:n},r,s){let a=__clone_10(n);return a.ref=__child_10(e,0),r.types&&r.types.tense&&(a.types.tense=r.types.tense),[[],[a],[],[r]]}}class CRNEGNBE extends Rule{constructor(e){super(e,S(capture("ref"),VP_(VP(BE(),"not",NP(DET(capture("det")),N(capture("noun")))))))}apply({ref:e,det:t,noun:n},r,s){let a=drs(this.ids);a.head=__clone_10(s),a.head.forEach(e=>e.closure=!0);let o=__clone_10(n);return o.ref=__child_10(e,0),r.types&&r.types.tense&&(o.types.tense=r.types.tense),a.push(o),[[],[negation(a)],[],[r]]}}class CRBE extends CompositeRule{constructor(e){super([new CRPOSBE(e),new CRNEGBE(e),new CRNBE(e),new CRNEGNBE(e),new CRPREPBE(e)])}}class CRCOND extends Rule{constructor(e){super(e,S("if",capture("head"),"then",capture("tail")))}apply({head:e,tail:t},n,r){let s=drs(this.ids);s.head.push(...__clone_10(r)),s.head.forEach(e=>e.closure=!0),s.push(e.children[1]);let a=drs(this.ids);return a.head.push(...__clone_10(s.head)),a.head.forEach(e=>e.closure=!0),a.push(t.children[3]),[[],[implication(s,a)],[],[n]]}}class CREVERY extends Rule{constructor(e){super(e,S(NP(DET("every"),N(capture("noun"))),VP_(capture("verb"))))}apply({noun:e,verb:t},n,r){let s=referent(this.id(),e.types),a=drs(this.ids);a.head.push(...__clone_10(r)),a.head.forEach(e=>e.closure=!0),a.head.push(s),e.ref=s,a.push(e);let o=drs(this.ids);o.head.push(...__clone_10(a.head)),o.head.forEach(e=>e.closure=!0);let i=__clone_10(n);return i.children[0]=s,o.push(i),[[],[implication(a,o)],[],[n]]}}class CRVPEVERY extends Rule{constructor(e){super(e,S(capture("subject"),VP_(VP(V(),NP(DET("every"),N(capture("noun")))))))}apply({subject:e,noun:t},n,r){let s=referent(this.id(),t.types),a=drs(this.ids);a.head.push(...__clone_10(r)),a.head.forEach(e=>e.closure=!0),a.head.push(s),t.ref=s,a.push(t);let o=drs(this.ids);o.head.push(...__clone_10(a.head)),o.head.forEach(e=>e.closure=!0);let i=__clone_10(n);return __child_10(i,1,0).children[1]=s,o.push(i),[[],[implication(a,o)],[],[n]]}}class CROR extends Rule{constructor(e){super(e,S(S(capture("a")),"or",S(capture("b"))))}apply({a:e,b:t},n,r){let s=drs(this.ids);s.head.push(...__clone_10(r)),s.head.forEach(e=>e.closure=!0),s.push(e);let a=drs(this.ids);return a.head.push(...__clone_10(s.head)),a.head.forEach(e=>e.closure=!0),a.push(t),[[],[disjunction(s,a)],[],[n]]}}class CRVPOR extends Rule{constructor(e){super(e,S(capture("n"),VP_(VP(VP(capture("a")),"or",VP(capture("b"))))))}apply({a:e,b:t,n:n},r,s){let a=drs(this.ids);a.head.push(...__clone_10(s)),a.head.forEach(e=>e.closure=!0),a.push(S(__clone_10(n.children[0]),VP_(e)));let o=drs(this.ids);return o.head.push(...__clone_10(a.head)),o.head.forEach(e=>e.closure=!0),o.push(S(__clone_10(n.children[0]),VP_(t))),[[],[disjunction(a,o)],[],[r]]}}class CRNPOR extends Rule{constructor(e){super(e,S(NP(NP(capture("first")),"or",NP(capture("second"))),VP_(capture("vp"))))}apply({first:e,second:t,vp:n},r,s){let a=drs(this.ids);a.head.push(...__clone_10(s)),a.head.forEach(e=>e.closure=!0),a.push(S(e,VP_(__clone_10(n))));let o=drs(this.ids);return o.head.push(...__clone_10(a.head)),o.head.forEach(e=>e.closure=!0),o.push(S(t,VP_(__clone_10(n)))),[[],[disjunction(a,o)],[],[r]]}}class CRSAND extends Rule{constructor(e){super(e,S(S(capture("a")),"and",S(capture("b"))))}apply({a:e,b:t},n,r){let s=drs(this.ids);s.head.push(...__clone_10(r)),s.head.forEach(e=>e.closure=!0),s.push(e);let a=drs(this.ids);return a.head.push(...__clone_10(s.head)),a.head.forEach(e=>e.closure=!0),a.push(t),[[],[conjunction(s,a)],[],[n]]}}class CRVPAND extends Rule{constructor(e){super(e,S(capture("subject"),VP_(VP(V(V(capture("a")),"and",V(capture("b"))),NP(capture("object"))))))}apply({subject:e,a:t,b:n,object:r},s,a){let o=drs(this.ids);o.head.push(...__clone_10(a)),o.head.forEach(e=>e.closure=!0),o.push(S(__clone_10(e.children[0]),VP_(VP(t,__clone_10(r)))));let i=drs(this.ids);return i.head.push(...__clone_10(o.head)),i.head.forEach(e=>e.closure=!0),i.push(S(__clone_10(e.children[0]),VP_(VP(n,__clone_10(r))))),[[],[conjunction(o,i)],[],[s]]}}class CRAND extends CompositeRule{constructor(e){super([new CRSAND(e),new CRVPAND(e)])}}class CRSPOSS extends Rule{constructor(e){super(e,S(NP(DET(capture("name"),"'s"),RN(capture("noun")))))}apply({name:e,noun:t,verb:n},r,s){let a=referent(this.id(),t.types,__print_10(__child_10(r,0),s));return r.children[0]=a,r.ref=a,[[a],[S(a,VP_(VP(V(t),e.children[0])))],[],[]]}}class CRVPPOSS extends Rule{constructor(e){super(e,VP(capture("verb"),NP(DET(capture("name"),"'s"),RN(capture("noun")))))}apply({name:e,noun:t,verb:n},r,s){let a=referent(this.id(),t.types,__print_10(__child_10(r,1),s));return r.children[1]=a,[[a],[S(a,VP_(VP(V(t),e.children[0])))],[],[]]}}class CRPOSS extends CompositeRule{constructor(e){super([new CRSPOSS(e),new CRVPPOSS(e)])}}class CRADJ extends Rule{constructor(e){super(e,N(ADJ(capture("adj")),N(capture("noun"))))}apply({adj:e,noun:t},n,r){return e=__clone_10(e),t=__clone_10(t),e.ref=n.ref,t.ref=n.ref,[[],[t,e],[],[n]]}}class CRSPP extends Rule{constructor(e){super(e,S(NP(DET(),N(N(capture("noun")),PP(PREP(capture("prep")),capture("np")))),VP_()))}apply({noun:e,prep:t,np:n},r,s){let a=referent(this.id(),e.types);return a.value=__print_10(__child_10(r,0),s),"DET"==__child_10(r,0,0)["@type"]&&"Every"==__child_10(r,0,0,0)?__child_10(r,0).children[1]=a:r.children[0]=a,e.ref=a,[[a],[e,S(a,VP_(VP(V(t),__child_10(n,1))))],[],[]]}}class CRVPPP extends Rule{constructor(e){super(e,S(capture("subject"),VP_(VP(V(),NP(DET(),N(N(capture("noun")),PP(PREP(capture("prep")),NP(capture("np")))))))))}apply({noun:e,prep:t,np:n},r,s){let a=referent(this.id(),e.types);return __child_10(r,1,0).children[1]=a,e.ref=a,[[a],[e,S(a,VP_(VP(V(t),n)))],[],[]]}}class CRPP extends CompositeRule{constructor(e){super([new CRSPP(e),new CRVPPP(e)])}}class CRWILL extends Rule{constructor(e){super(e,VP_(AUX("will"),VP(capture("verb"))))}apply({verb:e,aux:t},n,r){let{types:s}=n,{tense:a}=s||{};return"fut"!=a||n.children.shift(),[[],[],[],[]]}}class CRASPECT extends Rule{constructor(e){super(e,S(capture("sub"),VP_(VP(HAVE(),VP(capture("verb"))))))}apply({sub:e,verb:t},n){let r=(t.types||{}).stat;return r?(__child_10(n,1).children[0]=__child_10(n,1,0,1),"-"==r||"+"==r?[[],[],[],[]]:void 0):[[],[],[],[]]}}class CRQUESTIONIS extends Rule{constructor(e){super(e,Question(BE(capture("be")),NP(capture("sub")),ADJ(capture("adj")),"?"))}apply({be:e,sub:t,adj:n},r){let s=drs(this.ids);return s.push(S(t,VP_(VP(e,n)))),[[],[query(s)],[],[r]]}}class CRQUESTIONWHO extends Rule{constructor(e){super(e,Question("Who",VP_(capture("vp_")),"?"))}apply({vp_:e},t,n=[]){let r=drs(this.ids),s=referent(this.id(),{},"",n);return r.head.push(s),r.push(S(s,e)),[[s],[query(r,s)],[],[t]]}}class CRQUESTIONWHOM extends Rule{constructor(e){super(e,Question("Who",AUX(),NP(capture("sub")),V(capture("verb")),"?"))}apply({sub:e,verb:t},n,r=[]){let s=drs(this.ids),a=referent(this.id(),{},"",r);return s.head.push(a),s.push(S(e,VP_(VP(t,a)))),[[a],[query(s,a)],[],[n]]}}class CRQUESTION extends CompositeRule{constructor(e){super([new CRQUESTIONIS(e),new CRQUESTIONWHO(e),new CRQUESTIONWHOM(e)])}}class CRSTEM extends Rule{constructor(e){super(e,V(VERB(capture("stem"))))}apply({stem:e},t,n){let r=e.children[0];return t.children.length>1&&(r+=t.children[1]),t.children=[r],[[],[],[],[]]}}class CRPUNCT1 extends Rule{constructor(e){super(e,Sentence(Statement(S_(S(capture("s"))))))}apply({s:e},t){return[[],[e],[],[t]]}}class CRPUNCT2 extends Rule{constructor(e){super(e,Sentence(Question(capture("q"))))}apply({q:e},t){return[[],[e],[],[t]]}}class CRPUNCT extends CompositeRule{constructor(e){super([new CRPUNCT1(e),new CRPUNCT2(e)])}}function drs(e){return new __DRS_10(Rules.from(e))}function disjunction(e,t){return{"@type":"Disjunction",a:e,b:t,print(){return this.a.print()+" or "+this.b.print()}}}function implication(e,t){return{"@type":"Implication",a:e,b:t,print(){return this.a.print()+" => "+this.b.print()}}}function negation(e){return{"@type":"Negation",a:e,print(){return"~"+this.a.print()}}}function conjunction(e,t){return{"@type":"Conjunction",a:e,b:t,print(){return this.a.print()+" and "+this.b.print()}}}function query(e,t){return{"@type":"Query",drs:e,print(){return"exists("+(t?t.print():"")+") "+this.drs.print()+" ?"}}}class Rules{static from(e=new Ids){let t=[new CRASPECT(e),new CREVERY(e),new CRVPEVERY(e),new CRPP(e),new CRID(e),new CRLIN(e),new CRNRC(e),new CRPRO(e),new CRNEG(e),new CRPOSS(e),new CRBE(e),new CRCOND(e),new CROR(e),new CRVPOR(e),new CRNPOR(e),new CRAND(e),new CRADJ(e),new CRWILL(e),new CRQUESTION(e),new CRSTEM(e),new CRPUNCT(e)];return[new CRPN(e),t]}}var _$rules_10={Rules:Rules},_$browser_7={};const{parse:__parse_7}=_$parser_9,{DRS:__DRS_7}=_$drs_8,{Rules:__Rules_7}=_$rules_10,fs=_$_empty_11({}),files={};async function get(e,t,n){let r=await n(e+t);files[t]=await r.text()}return fs.readFileSync||(fs.readFileSync=function(e){let t=e.split("/");return files[t[t.length-1]]}),_$browser_7={load:async function(e="",t=fetch){await get(e,"string.ne",t),await get(e,"number.ne",t),await get(e,"whitespace.ne",t)},DRS:__DRS_7,Rules:__Rules_7,parse:__parse_7},_$browser_7}));